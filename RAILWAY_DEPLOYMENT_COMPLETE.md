# Complete Railway Deployment Guide for OneDollarAgent.ai

## Overview
This guide provides comprehensive instructions for deploying OneDollarAgent.ai to Railway with custom domain (www.onedollaragent.ai), managed Redis, and production-grade configuration.

## Prerequisites
- Railway account (railway.app)
- Namecheap account with onedollaragent.ai domain
- GitHub repository access
- All required environment variables and API keys

---

## Phase 1: Railway Project Setup

### 1. Create New Railway Project
```bash
# Install Railway CLI
npm install -g @railway/cli

# Login to Railway
railway login

# Create new project
railway create --name "onedollaragent-ai"
```

### 2. Connect GitHub Repository
1. Go to Railway dashboard
2. Connect your GitHub repository containing this codebase
3. Select the main/production branch for deployment

---

## Phase 2: Add Required Services

### 1. Add PostgreSQL Database
```bash
railway add postgres
```

### 2. Add Redis Cache
```bash
railway add redis
```

### 3. Verify Services
- PostgreSQL: Provides persistent database storage
- Redis: Required for session management, queuing, and caching
- Both services will auto-generate connection URLs

---

## Phase 3: Environment Variables Configuration

### Required Environment Variables

Set these in Railway dashboard under Variables tab:

#### Core Application
```bash
NODE_ENV=production
FRONTEND_URL=https://www.onedollaragent.ai
FORCE_HTTPS=true
```

#### Database & Redis (Auto-configured by Railway)
- `DATABASE_URL` - Auto-generated by PostgreSQL addon
- `REDIS_URL` - Auto-generated by Redis addon

#### Authentication & Security
```bash
SESSION_SECRET=<generate-secure-64-char-string>
JWT_SECRET=<generate-secure-64-char-string>
```

#### Stripe Payment Integration
```bash
STRIPE_SECRET_KEY=sk_live_...  # Live secret key for production
STRIPE_PUBLISHABLE_KEY=pk_live_...  # Live publishable key
STRIPE_WEBHOOK_SECRET=whsec_...  # Production webhook endpoint secret
```

#### AI Integration
```bash
OPENAI_API_KEY=sk-...  # OpenAI API key for AI functionality
```

### Generate Secure Secrets
Use this command to generate secure secrets:
```bash
node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
```

---

## Phase 4: Custom Domain Configuration

### 1. Add Custom Domain in Railway
1. Go to your Railway project
2. Navigate to Settings â†’ Domains
3. Click "Add Custom Domain"
4. Enter: `www.onedollaragent.ai`

### 2. Configure DNS in Namecheap
1. Log into Namecheap account
2. Go to Domain List â†’ Manage onedollaragent.ai
3. Navigate to Advanced DNS tab
4. Add these DNS records:

#### DNS Records Configuration
```dns
Type    Host    Value                           TTL
CNAME   www     [railway-generated-cname]      300
A       @       [railway-generated-ip]         300
```

**Railway will provide exact values after domain addition**

### 3. SSL Certificate
- Railway automatically provisions SSL certificates
- HTTPS will be available within 5-10 minutes
- Certificate auto-renews every 90 days

---

## Phase 5: Stripe Webhook Configuration

### Update Stripe Dashboard
1. Go to Stripe Dashboard â†’ Webhooks
2. Update webhook endpoint URL to:
   ```
   https://www.onedollaragent.ai/api/stripe/webhook
   ```
3. Configure these events:
   - `payment_intent.succeeded`
   - `checkout.session.completed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `invoice.payment_succeeded`
   - `invoice.payment_failed`

---

## Phase 6: Deployment Execution

### 1. Deploy to Railway
```bash
# Deploy current codebase
railway up

# Or connect via GitHub for auto-deployments
```

### 2. Monitor Deployment
```bash
# View real-time logs
railway logs

# Check service status
railway status
```

### 3. Verify Health Checks
- Health endpoint: `https://www.onedollaragent.ai/health`
- Ready check: `https://www.onedollaragent.ai/health/ready`
- Live check: `https://www.onedollaragent.ai/health/live`

---

## Phase 7: Production Verification

### 1. Environment Detection
Verify production environment is correctly detected:
```bash
railway logs | grep "AUTO-DETECTED"
```

Expected output:
```
ðŸš€ AUTO-DETECTED: Production environment for Railway deployment
   RAILWAY_ENVIRONMENT: production
   FRONTEND_URL: https://www.onedollaragent.ai
```

### 2. Redis Connectivity
Check Redis connection:
```bash
railway logs | grep "REDIS"
```

Expected output:
```
âœ… REDIS: Connection established successfully
âœ… SECURITY: Redis session store created
```

### 3. Database Connection
Verify PostgreSQL connection:
```bash
railway logs | grep "DATABASE"
```

### 4. Stripe Integration
Test payment flow:
1. Visit `https://www.onedollaragent.ai`
2. Navigate to payment page
3. Complete test purchase
4. Verify webhook delivery in Stripe Dashboard

---

## Phase 8: Domain Propagation & Testing

### 1. DNS Propagation Check
```bash
# Check DNS propagation globally
nslookup www.onedollaragent.ai
dig www.onedollaragent.ai

# Online tools
# https://dnschecker.org
# https://whatsmydns.net
```

### 2. SSL Certificate Verification
```bash
# Check SSL certificate
openssl s_client -connect www.onedollaragent.ai:443 -servername www.onedollaragent.ai

# Online tools
# https://www.ssllabs.com/ssltest/
```

### 3. End-to-End Testing
- [ ] Domain resolves to Railway
- [ ] HTTPS works correctly
- [ ] Application loads successfully
- [ ] User registration/login works
- [ ] Payment processing works
- [ ] AI functionality works
- [ ] WebSocket connections work

---

## Scaling & Monitoring

### 1. Auto-scaling Configuration
Railway supports horizontal scaling:
```json
{
  "deploy": {
    "replicas": 1,
    "autoscaling": {
      "enabled": true,
      "minReplicas": 1,
      "maxReplicas": 5,
      "targetCPU": 70,
      "targetMemory": 80
    }
  }
}
```

### 2. Monitoring & Alerts
- Railway provides built-in monitoring
- Set up alerts for high CPU, memory, or error rates
- Monitor database and Redis usage

---

## Rollback Procedures

### Emergency Rollback
```bash
# Rollback to previous deployment
railway rollback

# Or deploy specific commit
railway up --detach <commit-hash>
```

### Database Rollback
- PostgreSQL: Use Railway backups
- Redis: Flush cache if needed

---

## Production Checklist

### Before Launch
- [ ] All environment variables configured
- [ ] Database migrations completed
- [ ] Redis connectivity verified
- [ ] Custom domain configured
- [ ] SSL certificate active
- [ ] Stripe webhooks updated
- [ ] Health checks passing
- [ ] End-to-end testing completed

### Post-Launch Monitoring
- [ ] Application performance metrics
- [ ] Database performance
- [ ] Redis memory usage
- [ ] Error rate monitoring
- [ ] User feedback collection

---

## Support & Troubleshooting

### Common Issues

#### 1. Environment Variables Not Loading
```bash
# Check variables are set
railway vars

# Restart service
railway redeploy
```

#### 2. Domain Not Resolving
- Verify DNS records in Namecheap
- Check Railway domain configuration
- Wait for DNS propagation (up to 48 hours)

#### 3. SSL Certificate Issues
- Verify domain ownership
- Check Railway SSL status
- Restart service if needed

#### 4. Redis Connection Failures
```bash
# Check Redis addon status
railway status

# View Redis-specific logs
railway logs | grep "REDIS"
```

### Railway CLI Commands
```bash
railway login          # Authenticate with Railway
railway projects        # List projects
railway status         # Check service status
railway logs           # View application logs
railway shell          # Access production shell
railway vars           # Manage environment variables
railway redeploy       # Force redeploy
railway rollback       # Rollback deployment
```

---

## Security Considerations

### 1. Environment Variables
- Never commit secrets to version control
- Use Railway's secure variable storage
- Rotate secrets regularly

### 2. Database Security
- Railway PostgreSQL includes encryption at rest
- Use connection pooling for performance
- Regular security updates via Railway

### 3. Redis Security
- Railway Redis includes authentication
- Data encryption in transit and at rest
- Memory-only storage for sensitive sessions

### 4. HTTPS Enforcement
- Automatic HTTPS redirect configured
- HSTS headers enabled
- Secure cookie configuration

---

## Cost Optimization

### Railway Pricing Tiers
- **Hobby Plan**: $5/month per service
- **Pro Plan**: Usage-based pricing
- **Team Plan**: Enhanced collaboration features

### Resource Monitoring
```bash
# Monitor resource usage
railway metrics

# View billing information
railway billing
```

### Optimization Tips
1. Use Redis for caching to reduce database load
2. Optimize database queries
3. Enable compression for static assets
4. Monitor and optimize memory usage

---

This completes the comprehensive Railway deployment setup for www.onedollaragent.ai with production-grade configuration, monitoring, and scaling capabilities.